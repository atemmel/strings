#!/bin/cherry

import fs

assert (fs'has-program g++)
assert (fs'has-program mkdir)
assert (fs'has-program poop)

mkdir -p build/

cpp-files := *.cpp

for cpp-file in $cpp-files {
    prog-name := (slice $cpp-file 0 (- (len $cpp-file) 4))

    g++ -Ofast -o "build/{prog-name}" $cpp-file
    #g++ -o "build/{prog-name}" $cpp-file
}

#TODO: "uppackning" hade gått hårt här
#poop ...$arg-strs

needle := afternoon

fn bench {
    poop "./build/linear {corpus} {needle}" "./build/boyer-moore {corpus} {needle}" "./build/threaded {corpus} {needle}" 
    # |> "{corpus}-result"
}

corpuses := corpus-*

for corpus in $corpuses {
    bench
}
